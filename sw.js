const CACHE_NAME="cerita-sekitarmu-v3.0.0",APP_SHELL_CACHE="app-shell-v3",BASE_PATH="/ceritamu",ESSENTIAL_FILES=[`${BASE_PATH}/`,`${BASE_PATH}/index.html`,`${BASE_PATH}/main.bundle.js`,`${BASE_PATH}/styles.css`,`${BASE_PATH}/manifest.json`,`${BASE_PATH}/283.main.bundle.js`,`${BASE_PATH}/327.main.bundle.js`,`${BASE_PATH}/395.main.bundle.js`,`${BASE_PATH}/408.main.bundle.js`,`${BASE_PATH}/451.main.bundle.js`,`${BASE_PATH}/611.main.bundle.js`,`${BASE_PATH}/724.main.bundle.js`],OPTIONAL_FILES=[`${BASE_PATH}/favicon.png`,`${BASE_PATH}/icons/icon-72x72.png`,`${BASE_PATH}/icons/icon-96x96.png`,`${BASE_PATH}/icons/icon-128x128.png`,`${BASE_PATH}/icons/icon-144x144.png`,`${BASE_PATH}/icons/icon-152x152.png`,`${BASE_PATH}/icons/icon-192x192.png`,`${BASE_PATH}/icons/icon-384x384.png`,`${BASE_PATH}/icons/icon-512x512.png`];async function handleChunkRequest(n){const e=await caches.match(n);if(e)return console.log(`üìÇ Serving chunk from cache: ${new URL(n.url).pathname}`),e;try{const e=await fetch(n);return 200===e.status&&(await caches.open("app-shell-v3")).put(n,e.clone()),e}catch(e){return console.error(`‚ùå Chunk load failed: ${new URL(n.url).pathname}`),new Response("Chunk load failed",{status:404,statusText:"Chunk Not Found"})}}async function handleNormalRequest(n){try{const e=await fetch(n);return 200===e.status&&(await caches.open("app-shell-v3")).put(n,e.clone()),e}catch(e){console.log(`‚ùå Network error: ${new URL(n.url).pathname}`);const a=await caches.match(n);if(a)return a;if("document"===n.destination||n.headers.get("accept")?.includes("text/html")){const n=await caches.match(`${BASE_PATH}/index.html`);if(n)return n}return createOfflineResponse()}}function createOfflineResponse(){return new Response('\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <title>Anda Sedang Offline - Cerita di Sekitarmu</title>\n        <style>\n          body { \n            font-family: Arial, sans-serif; \n            text-align: center; \n            padding: 50px; \n            background: #f5f5f5;\n            margin: 0;\n          }\n          .container { \n            background: white; \n            padding: 40px; \n            border-radius: 10px; \n            box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n            max-width: 500px;\n            margin: 100px auto;\n          }\n          h1 { color: #666; margin-bottom: 20px; }\n          p { color: #888; line-height: 1.6; }\n          button {\n            background: #007bff;\n            color: white;\n            border: none;\n            padding: 12px 24px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 16px;\n            margin-top: 20px;\n          }\n          button:hover {\n            background: #0056b3;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="container">\n          <h1>üì∂ Anda Sedang Offline</h1>\n          <p>Aplikasi membutuhkan koneksi internet untuk mengambil data cerita terbaru.</p>\n          <p>Silakan periksa koneksi internet Anda dan coba lagi.</p>\n          <button onclick="window.location.reload()">Coba Lagi</button>\n        </div>\n      </body>\n    </html>\n  ',{status:503,statusText:"Service Unavailable",headers:{"Content-Type":"text/html; charset=utf-8","Cache-Control":"no-cache"}})}self.addEventListener("install",(n=>{console.log("üîß Service Worker: Memulai instalasi..."),console.log("üìç Base Path:",BASE_PATH),n.waitUntil(self.skipWaiting()),n.waitUntil((async()=>{try{const n=await caches.open("app-shell-v3");console.log("üíæ Membuka cache..."),console.log("üì¶ Caching file essential...");const e=(await Promise.allSettled(ESSENTIAL_FILES.map((e=>n.add(e).catch((n=>(console.warn(`‚ö†Ô∏è Gagal cache essential ${e}:`,n.message),null))))))).filter((n=>"fulfilled"===n.status&&null!==n.value)).length;console.log(`‚úÖ ${e}/${ESSENTIAL_FILES.length} file essential berhasil di-cache`),console.log("üì¶ Caching file optional...");const a=(await Promise.allSettled(OPTIONAL_FILES.map((async e=>{try{return await n.add(e),console.log(`‚úÖ Berhasil cache optional: ${e}`),{success:!0,url:e}}catch(n){return console.warn(`‚ö†Ô∏è Gagal cache optional ${e}:`,n.message),{success:!1,url:e,error:n.message}}})))).filter((n=>"fulfilled"===n.status&&n.value.success)).length;console.log(`üìä Cache result: ${e}/${ESSENTIAL_FILES.length} essential, ${a}/${OPTIONAL_FILES.length} optional berhasil`),console.log("üéâ Proses caching selesai")}catch(n){console.error("‚ùå Error utama saat caching:",n)}})())})),self.addEventListener("activate",(n=>{console.log("üîÑ Service Worker: Mengaktifkan..."),n.waitUntil((async()=>{await self.clients.claim();try{const n=await caches.keys();await Promise.all(n.map((async n=>{"app-shell-v3"!==n&&n!==CACHE_NAME&&(console.log(`üóëÔ∏è Menghapus cache lama: ${n}`),await caches.delete(n))})))}catch(n){console.warn("‚ö†Ô∏è Error cleaning old caches:",n)}console.log("‚úÖ Service Worker aktif dan siap!")})())})),self.addEventListener("fetch",(n=>{const{request:e}=n;if("GET"!==e.method)return;const a=new URL(e.url);a.href.includes("story-api.dicoding.dev")||a.href.startsWith(self.location.origin)&&(a.pathname.includes(".bundle.js")||a.pathname.includes(".chunk.js")?n.respondWith(handleChunkRequest(e)):n.respondWith(handleNormalRequest(e)))})),self.addEventListener("push",(n=>{console.log("üì® Menerima push notification");const e={body:"Ada cerita baru di sekitarmu! üìñ",icon:`${BASE_PATH}/icons/icon-192x192.png`,badge:`${BASE_PATH}/icons/icon-72x72.png`,tag:"cerita-notification"};n.waitUntil(self.registration.showNotification("Cerita di Sekitarmu",e))})),self.addEventListener("notificationclick",(n=>{console.log("üëÜ Notification diklik"),n.notification.close(),n.waitUntil(self.clients.matchAll({type:"window"}).then((n=>{for(const e of n)if(e.url.includes(self.location.origin))return e.focus();return self.clients.openWindow(`${BASE_PATH}/`)})))})),console.log("üöÄ Service Worker loaded dan siap! Versi 3.0.0"),console.log("üìç Base Path:",BASE_PATH);